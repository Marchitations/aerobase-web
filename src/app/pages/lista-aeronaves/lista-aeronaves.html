<div class="form-cadastro card">
  <h3>Cadastrar nova aeronave</h3>

  <form (ngSubmit)="salvar()" #form="ngForm" class="formulario">
    <mat-form-field appearance="fill" class="campo">
      <mat-label>Nome</mat-label>
      <input matInput name="nome" [(ngModel)]="novaAeronave.nome" required />
    </mat-form-field>

    <mat-form-field appearance="fill" class="campo">
      <mat-label>Marca</mat-label>
      <mat-select name="marca" [(ngModel)]="novaAeronave.marca" required>
        <mat-option *ngFor="let marca of marcas" [value]="marca">
          {{ marca }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="campo pequeno">
      <mat-label>Ano</mat-label>
      <input
        matInput
        type="number"
        name="ano"
        [(ngModel)]="novaAeronave.ano"
        required
      />
    </mat-form-field>

    <mat-form-field appearance="fill" class="campo grande">
      <mat-label>Descrição</mat-label>
      <textarea
        matInput
        rows="2"
        name="descricao"
        [(ngModel)]="novaAeronave.descricao"
      ></textarea>
    </mat-form-field>

    <mat-checkbox
      name="vendido"
      [(ngModel)]="novaAeronave.vendido"
      class="campo"
      >Vendido</mat-checkbox
    >

    <div class="botoes-form">
      <button mat-flat-button color="primary" type="submit">
        Salvar
      </button>
    </div>
  </form>
</div>

<div
  class="painel-estatisticas card"
  *ngIf="!carregando && aeronavesFiltradas.length > 0"
>
  <div class="card-estatistica">
    <p>Aeronaves não vendidas</p>
    <h3>{{ totalNaoVendidas }}</h3>
  </div>

  <div class="card-estatistica">
    <p>Essa Semana</p>
    <h3>{{ ultimaSemana }}</h3>
  </div>

  <div class="card-estatistica lista-decadas">
    <h4>Por década</h4>
    <div class="grid-decadas">
      <div class="item-decada" *ngFor="let item of aeronavesPorDecada">
        <span class="decada">{{ item.decada }}</span>
        <span class="quantidade">{{ item.quantidade }}</span>
      </div>
    </div>
  </div>
</div>

<div class="barra-pesquisa card">
  <mat-form-field appearance="outline" class="campo-pesquisa">
    <mat-label>Pesquisar aeronaves</mat-label>
    <span matPrefix><mat-icon>search</mat-icon>&nbsp;</span>
    <input
      matInput
      placeholder="Digite parte do nome, marca, ano ou descrição"
      [(ngModel)]="termoPesquisa"
      (input)="onTermoDigitado()"
    />
    <button
      *ngIf="termoPesquisa"
      mat-icon-button
      matSuffix
      aria-label="Limpar pesquisa"
      (click)="termoPesquisa=''; onTermoDigitado();"
    >
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>
</div>

<div *ngIf="!carregando && aeronavesFiltradas.length === 0" class="mensagem-vazia">
  <mat-icon>info</mat-icon>
  Nenhuma aeronave encontrada.
</div>

<h2>Lista de Aeronaves</h2>

<table
  mat-table
  [dataSource]="aeronavesFiltradas"
  multiTemplateDataRows
  class="mat-elevation-z1 tabela-aeronaves"
>
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef>ID</th>
    <td mat-cell *matCellDef="let row">{{ row.id }}</td>
  </ng-container>

  <ng-container matColumnDef="marca">
    <th mat-header-cell *matHeaderCellDef>Marca</th>
    <td mat-cell *matCellDef="let row">{{ row.marca }}</td>
  </ng-container>

  <ng-container matColumnDef="nome">
    <th mat-header-cell *matHeaderCellDef>Nome</th>
    <td mat-cell *matCellDef="let row">{{ row.nome }}</td>
  </ng-container>

  <ng-container matColumnDef="ano">
    <th mat-header-cell *matHeaderCellDef>Ano</th>
    <td mat-cell *matCellDef="let row">{{ row.ano }}</td>
  </ng-container>

  <ng-container matColumnDef="vendido">
    <th mat-header-cell *matHeaderCellDef>Vendido</th>
    <td mat-cell *matCellDef="let row">{{ row.vendido ? 'Sim' : 'Não' }}</td>
  </ng-container>

  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let row" [attr.colspan]="colunas.length">
      <div
        class="detalhes-aeronave"
        *ngIf="aeronaveSelecionada?.id === row.id"
      >
        <div class="info">
          <p><strong>Descrição:</strong> {{ row.descricao || 'Sem descrição' }}</p>
          <p><strong>Criado em:</strong> {{ row.criado | date: 'dd/MM/yyyy HH:mm' }}</p>
          <p><strong>Atualizado em:</strong> {{ row.atualizado | date: 'dd/MM/yyyy HH:mm' }}</p>
        </div>

        <div class="botoes">
          <button
            mat-flat-button
            color="primary"
            (click)="abrirDialogEdicao(row); $event.stopPropagation()"
          >
            Editar
          </button>
          <button
            mat-stroked-button
            color="warn"
            (click)="abrirDialogExclusao(row); $event.stopPropagation()"
          >
            Excluir
          </button>
        </div>
      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="colunas"></tr>

  <tr
    mat-row
    *matRowDef="let row; columns: colunas"
    class="linha-aeronave"
    [class.selecionada]="aeronaveSelecionada?.id === row.id"
    (click)="selecionarAeronave(row)"
  ></tr>

  <tr
    mat-row
    *matRowDef="let row; columns: ['expandedDetail']"
    class="linha-detalhes"
  ></tr>
</table>
